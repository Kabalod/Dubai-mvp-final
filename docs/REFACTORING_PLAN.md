# План рефакторинга: Переход на мульти-репозиторную архитектуру

## 1. Цель

Разделить текущий монорепозиторий `Workerproject` на несколько независимых репозиториев для каждого сервиса и создать "проект-оркестратор" для централизованного управления.

**Проблемы, которые решаем:**
- Слишком много несвязанных файлов в корне.
- Сложность в разделении разработки между командами (AI и коммерческий проект).
- Отсутствие четких границ между сервисами.

## 2. Финальная архитектура

- **`Workerproject` (репозиторий-оркестратор):**
  - Не будет содержать кода приложений.
  - Будет содержать `docker-compose.yml`, `Taskfile.yml`, `meta-manager.ps1` для управления.
  - Будет содержать `git submodule` ссылки на репозитории сервисов.

- **Отдельные репозитории для каждого сервиса:**
  - `Dubai-Realty-Backend` (из `apps/realty-main`)
  - `Dubai-PFImport-Service` (из `apps/pfimport-main`)
  - `Dubai-Frontend` (из `apps/DXB-frontend-develop`)
  - `MemoryProjectDubai` (уже существует)
  - `Dubai-Docs` (документация)
  - ... и другие по необходимости.

## 3. План работ

### Шаг 1: Создание новых репозиториев на GitHub
- [ ] Создать пустые репозитории на GitHub для каждого сервиса, который будет вынесен. Репозитории должны быть созданы **без** `README` или `.gitignore`.
  - `Dubai-Realty-Backend`
  - `Dubai-PFImport-Service`
  - `Dubai-Frontend`
  - `Dubai-Docs`

### Шаг 2: Выделение сервисов в отдельные репозитории
- Для каждого сервиса будет выполнена следующая процедура:
  1. Создается временный клон `Workerproject`.
  2. С помощью `git-filter-repo` история коммитов фильтруется так, чтобы остались только коммиты, относящиеся к папке сервиса (например, `apps/realty-main`).
  3. Отфильтрованная история загружается (push) в соответствующий новый репозиторий (например, `Dubai-Realty-Backend`).

### Шаг 3: Реструктуризация `Workerproject` в оркестратор
1.  **Создание новой ветки:**
    - [ ] Создать ветку `refactor/multi-repo` для безопасного проведения изменений.
2.  **Удаление кода сервисов:**
    - [ ] Удалить папки `apps/`, `packages/` и другие, которые будут вынесены.
3.  **Подключение сабмодулей:**
    - [ ] Подключить каждый новый репозиторий как `git submodule` в папку `services/`.
    ```bash
    git submodule add https://github.com/Kabalod/Dubai-Realty-Backend.git services/realty-backend
    git submodule add https://github.com/Kabalod/Dubai-Frontend.git services/frontend
    # ... и так далее
    ```
4.  **Обновление `docker-compose.yml`:**
    - [ ] Изменить пути `context` в `build` секциях, чтобы они указывали на папки сабмодулей (например, `context: ./services/realty-backend`).
5.  **Обновление `Taskfile.yml`:**
    - [ ] Изменить пути `dir` для команд, чтобы они указывали на папки сабмодулей.
6.  **Обновление `meta-manager.ps1`:**
    - [ ] Обновить `repos.json`, чтобы он содержал пути к сабмодулям в папке `services/`.
7.  **Обновление CI/CD:**
    - [ ] CI/CD для `Workerproject` теперь должен проверять только файлы оркестратора. Основные CI пайплайны (тесты, сборки) должны быть перенесены в репозитории соответствующих сервисов.

### Шаг 4: Тестирование и завершение
1.  **Локальная проверка:**
    - [ ] Выполнить `git clone --recursive`, чтобы убедиться, что сабмодули корректно скачиваются.
    - [ ] Запустить `task docker:up`, чтобы убедиться, что все сервисы собираются и запускаются.
2.  **Слияние ветки:**
    - [ ] После успешной проверки слить ветку `refactor/multi-repo` в `main`.

## 4. Ожидаемый результат

- Чистый и легковесный репозиторий-оркестратор.
- Полностью независимые репозитории для каждого сервиса с их собственной историей.
- Упрощенное управление зависимостями и CI/CD.
- Четкое разделение ответственности между командами.
