# –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –û–±–∑–æ—Ä

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –ø—Ä–æ–µ–∫—Ç–∞ Dubai.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Prometheus    ‚îÇ    ‚îÇ     Grafana     ‚îÇ    ‚îÇ   Alertmanager  ‚îÇ
‚îÇ   (–ú–µ—Ç—Ä–∏–∫–∏)     ‚îÇ    ‚îÇ (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)  ‚îÇ    ‚îÇ   (–ê–ª–µ—Ä—Ç—ã)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Pushgateway   ‚îÇ
                    ‚îÇ (Batch –º–µ—Ç—Ä–∏–∫–∏) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫
- **Real Estate API** - Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **Analytics Service** - FastAPI —Å–µ—Ä–≤–∏—Å
- **AI Gateway** - AI —Å–µ—Ä–≤–∏—Å—ã
- **Memory LLM Service** - Java —Å–µ—Ä–≤–∏—Å
- **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –ö—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏
- **Nginx** - Reverse proxy

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### API –º–µ—Ç—Ä–∏–∫–∏
```python
from prometheus_client import Counter, Histogram, Gauge

## –°—á–µ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
http_requests_total = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status']
)

## –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
http_request_duration_seconds = Histogram(
    'http_request_duration_seconds',
    'HTTP request duration',
    ['method', 'endpoint']
)

## –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
http_connections_active = Gauge(
    'http_connections_active',
    'Active HTTP connections'
)
```

### –ë–∏–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∏
```python
## –ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
properties_total = Gauge('properties_total', 'Total properties')
properties_by_status = Gauge(
    'properties_by_status',
    'Properties by status',
    ['status']
)

## –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users_total = Gauge('users_total', 'Total users')
active_users = Gauge('active_users', 'Active users in last 24h')

## AI –º–µ—Ç—Ä–∏–∫–∏
ai_queries_total = Counter(
    'ai_queries_total',
    'Total AI queries',
    ['agent_type', 'status']
)

ai_response_time = Histogram(
    'ai_response_time_seconds',
    'AI response time',
    ['agent_type']
)
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```python
## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
db_connections_active = Gauge('db_connections_active', 'Active DB connections')
db_query_duration = Histogram('db_query_duration_seconds', 'DB query duration')

## Redis
redis_connections = Gauge('redis_connections', 'Redis connections')
redis_memory_usage = Gauge('redis_memory_bytes', 'Redis memory usage')

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
cpu_usage_percent = Gauge('cpu_usage_percent', 'CPU usage percentage')
memory_usage_bytes = Gauge('memory_usage_bytes', 'Memory usage in bytes')
disk_usage_percent = Gauge('disk_usage_percent', 'Disk usage percentage')
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è prometheus.yml
```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alerts.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  - job_name: 'real-estate-api'
    static_configs:
      - targets: ['real-estate-api:8000']
    metrics_path: '/metrics'
    scrape_interval: 10s

  - job_name: 'analytics-service'
    static_configs:
      - targets: ['analytics-service:8001']
    metrics_path: '/metrics'
    scrape_interval: 10s

  - job_name: 'ai-gateway'
    static_configs:
      - targets: ['ai-gateway:8003']
    metrics_path: '/metrics'
    scrape_interval: 10s

  - job_name: 'memory-llm-service'
    static_configs:
      - targets: ['memory-llm-service:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 15s

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
    scrape_interval: 30s

  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
    scrape_interval: 30s

  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:9113']
    scrape_interval: 30s
```

### Docker Compose –¥–ª—è Prometheus
```yaml
version: '3.8'
services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus:/etc/prometheus
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=200h'
      - '--web.enable-lifecycle'

  postgres-exporter:
    image: prometheuscommunity/postgres-exporter:latest
    environment:
      DATA_SOURCE_NAME: "postgresql://user:pass@postgres:5432/dubai?sslmode=disable"
    ports:
      - "9187:9187"

  redis-exporter:
    image: oliver006/redis_exporter:latest
    environment:
      REDIS_ADDR: "redis://redis:6379"
    ports:
      - "9121:9121"

  nginx-exporter:
    image: nginx/nginx-prometheus-exporter:latest
    command:
      - -nginx.scrape-uri=http://nginx/nginx_status
    ports:
      - "9113:9113"

volumes:
  prometheus_data:
```

## üìà –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

#### 1. API Overview Dashboard
```json
{
  "dashboard": {
    "title": "API Overview",
    "panels": [
      {
        "title": "HTTP Requests per Second",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{endpoint}}"
          }
        ]
      },
      {
        "title": "Response Time",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ]
      },
      {
        "title": "Error Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m])",
            "legendFormat": "5xx errors"
          }
        ]
      }
    ]
  }
}
```

#### 2. Business Metrics Dashboard
```json
{
  "dashboard": {
    "title": "Business Metrics",
    "panels": [
      {
        "title": "Properties by Status",
        "type": "piechart",
        "targets": [
          {
            "expr": "properties_by_status",
            "legendFormat": "{{status}}"
          }
        ]
      },
      {
        "title": "Active Users",
        "type": "stat",
        "targets": [
          {
            "expr": "active_users",
            "legendFormat": "Active Users"
          }
        ]
      },
      {
        "title": "AI Queries",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(ai_queries_total[5m])",
            "legendFormat": "{{agent_type}}"
          }
        ]
      }
    ]
  }
}
```

#### 3. System Health Dashboard
```json
{
  "dashboard": {
    "title": "System Health",
    "panels": [
      {
        "title": "CPU Usage",
        "type": "gauge",
        "targets": [
          {
            "expr": "cpu_usage_percent",
            "legendFormat": "CPU %"
          }
        ]
      },
      {
        "title": "Memory Usage",
        "type": "gauge",
        "targets": [
          {
            "expr": "memory_usage_bytes / 1024 / 1024 / 1024",
            "legendFormat": "Memory GB"
          }
        ]
      },
      {
        "title": "Database Connections",
        "type": "graph",
        "targets": [
          {
            "expr": "db_connections_active",
            "legendFormat": "Active Connections"
          }
        ]
      }
    ]
  }
}
```

### –ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤
```bash
## –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
mkdir -p monitoring/grafana/dashboards

## –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤ –¥–∞—à–±–æ—Ä–¥–æ–≤
cp api-overview.json monitoring/grafana/dashboards/
cp business-metrics.json monitoring/grafana/dashboards/
cp system-health.json monitoring/grafana/dashboards/

## –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ Grafana API
curl -X POST \
  -H "Content-Type: application/json" \
  -d @monitoring/grafana/dashboards/api-overview.json \
  http://admin:admin@localhost:3000/api/dashboards/db
```

## üö® –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è alerts.yml
```yaml
groups:
  - name: api_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors per second"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High response time detected"
          description: "95th percentile response time is {{ $value }} seconds"

  - name: business_alerts
    rules:
      - alert: NoNewProperties
        expr: increase(properties_total[1h]) == 0
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "No new properties added"
          description: "No new properties have been added in the last hour"

      - alert: LowActiveUsers
        expr: active_users < 10
        for: 30m
        labels:
          severity: warning
        annotations:
          summary: "Low active users"
          description: "Only {{ $value }} active users"

  - name: system_alerts
    rules:
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is {{ $value }}%"

      - alert: HighMemoryUsage
        expr: memory_usage_bytes / 1024 / 1024 / 1024 > 8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value }} GB"

      - alert: DatabaseConnectionHigh
        expr: db_connections_active > 50
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High database connections"
          description: "{{ $value }} active database connections"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alertmanager
```yaml
global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@dubai-project.com'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://localhost:5001/'

  - name: 'email'
    email_configs:
      - to: 'admin@dubai-project.com'
        send_resolved: true

  - name: 'slack'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts'
        send_resolved: true
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Structured Logging
```python
import logging
import json
from datetime import datetime

class JSONFormatter(logging.Formatter):
    def format(self, record):
        log_entry = {
            'timestamp': datetime.utcnow().isoformat(),
            'level': record.levelname,
            'logger': record.name,
            'message': record.getMessage(),
            'module': record.module,
            'function': record.funcName,
            'line': record.lineno
        }
        
        if hasattr(record, 'user_id'):
            log_entry['user_id'] = record.user_id
        
        if hasattr(record, 'request_id'):
            log_entry['request_id'] = record.request_id
        
        if record.exc_info:
            log_entry['exception'] = self.formatException(record.exc_info)
        
        return json.dumps(log_entry)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
logger = logging.getLogger('dubai_api')
logger.setLevel(logging.INFO)

handler = logging.StreamHandler()
handler.setFormatter(JSONFormatter())
logger.addHandler(handler)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
logger.info('User login successful', extra={
    'user_id': 123,
    'request_id': 'req_456'
})
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
```python
import logging
from logging.handlers import RotatingFileHandler

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
file_handler = RotatingFileHandler(
    'logs/dubai_api.log',
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5
)

file_handler.setFormatter(JSONFormatter())
logger.addHandler(file_handler)

## –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
auth_logger = logging.getLogger('dubai_auth')
property_logger = logging.getLogger('dubai_property')
ai_logger = logging.getLogger('dubai_ai')
```

## üîç –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### ELK Stack –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
version: '3.8'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data

  logstash:
    image: docker.elastic.co/logstash/logstash:7.17.0
    volumes:
      - ./monitoring/logstash/pipeline:/usr/share/logstash/pipeline
      - ./logs:/logs
    ports:
      - "5044:5044"
      - "5000:5000/tcp"
      - "5000:5000/udp"
      - "9600:9600"
    environment:
      LS_JAVA_OPTS: "-Xmx256m -Xms256m"

  kibana:
    image: docker.elastic.co/kibana/kibana:7.17.0
    ports:
      - "5601:5601"
    environment:
      ELASTICSEARCH_URL: http://elasticsearch:9200
      ELASTICSEARCH_HOSTS: '["http://elasticsearch:9200"]'

volumes:
  elasticsearch_data:
```

### Logstash pipeline
```ruby
input {
  file {
    path => "/logs/*.log"
    type => "dubai_logs"
    start_position => "beginning"
  }
}

filter {
  if [type] == "dubai_logs" {
    json {
      source => "message"
    }
    
    date {
      match => [ "timestamp", "ISO8601" ]
    }
    
    if [user_id] {
      mutate {
        add_field => { "user_id" => "%{[user_id]}" }
      }
    }
    
    if [request_id] {
      mutate {
        add_field => { "request_id" => "%{[request_id]}" }
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "dubai-logs-%{+YYYY.MM.dd}"
  }
}
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
## –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.monitoring.yml up -d

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose -f docker-compose.monitoring.yml ps

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose -f docker-compose.monitoring.yml logs -f prometheus
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
## Prometheus
curl http://localhost:9090/api/v1/targets

## Grafana
open http://localhost:3000
## –õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: admin

## Elasticsearch
curl http://localhost:9200/_cluster/health

## Kibana
open http://localhost:5601
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [ELK Stack Documentation](https://www.elastic.co/guide/)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [Prometheus Query Examples](https://prometheus.io/docs/prometheus/latest/querying/examples/)
- [Grafana Dashboard Examples](https://grafana.com/grafana/dashboards/)

---

**–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–Ω—ã–π  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ê–≤–≥—É—Å—Ç 2025

